<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>LiveTransceiver - resol-vbus-c</title>


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="index.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="Details.html"><strong aria-hidden="true">2.</strong> Details</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ErrorHandling.html"><strong aria-hidden="true">2.1.</strong> Error handling</a></li><li class="chapter-item expanded "><a href="LiveEncoder.html"><strong aria-hidden="true">2.2.</strong> LiveEncoder</a></li><li class="chapter-item expanded "><a href="LiveDecoder.html"><strong aria-hidden="true">2.3.</strong> LiveDecoder</a></li><li class="chapter-item expanded "><a href="LiveTransceiver.html" class="active"><strong aria-hidden="true">2.4.</strong> LiveTransceiver</a></li><li class="chapter-item expanded "><a href="Debugging.html"><strong aria-hidden="true">2.5.</strong> Debugging</a></li></ol></li><li class="chapter-item expanded "><a href="Examples.html"><strong aria-hidden="true">3.</strong> Examples</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="MasterExample.html"><strong aria-hidden="true">3.1.</strong> Master</a></li><li class="chapter-item expanded "><a href="MinionExample.html"><strong aria-hidden="true">3.2.</strong> Minion</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">resol-vbus-c</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="livetransceiver"><a class="header" href="#livetransceiver">LiveTransceiver</a></h1>
<p>The &quot;LiveTransceiver&quot; module implements the <code>RESOLVBUS_LIVETRANSCEIVER</code> type and its associated functions, which combines the functionalities of the &quot;LiveEncoder&quot; and &quot;LiveDecoder&quot; modules to communicate with a VBus controller, e.g. to access its parameters.</p>
<h2 id="initialization-and-integration"><a class="header" href="#initialization-and-integration">Initialization and integration</a></h2>
<p>Before the transceiver can be used, it must be initialized by calling <code>ResolVBus_LiveTransceiver_Initialize</code>:</p>
<pre><code>// ...
RESOLVBUS_LIVETRANSCEIVER Transceiver = RESOLVBUS_LIVETRANSCEIVER_INITIALIZER;
uint8_t EncoderBuffer [512];
uint8_t DecoderBuffer [512];
if (Result == RESOLVBUS_OK) {
    Result = ResolVBus_LiveTransceiver_Initialize(Transceiver, EncoderBuffer, sizeof (EncoderBuffer), DecoderBuffer, sizeof (DecoderBuffer), LiveTransceiverHandler);
}
// ...
</code></pre>
<p>The function takes six arguments: the transceiver instance itself, a transmission buffer as well as its length, an optional buffer for holding decoded frame data as well as its length and an event handler function.</p>
<p>The transmission buffer is used by the <code>ResolVBus_LiveEncoder_Queue...</code> functions to store the over-the-wire representation of the VBus primitives. It must be large enough to hold the largest VBus primitive that is expected to be transmitted.</p>
<p>The optional decoder buffer is used to reassemble the contents of multiple VBus packet or telegram frames. If no buffer is provided, the reassembly must be done manually.</p>
<p>The event handler is a function that is called whenever the transceiver wants to inform its user about an event:</p>
<ul>
<li><code>RESOLVBUS_LIVETRANSCEIVEREVENTTYPE_TIMEOUT</code>: the action started on the transceiver has timed out (optionally after several retries)</li>
<li><code>RESOLVBUS_LIVETRANSCEIVEREVENTTYPE_ENCODER</code>: the &quot;LiveEncoder&quot; part of the transceiver has emitted an event (e.g. to transmit data)</li>
<li><code>RESOLVBUS_LIVETRANSCEIVEREVENTTYPE_DECODER</code>:  the &quot;LiveDecoder&quot; part of the transceiver has emitted an event (e.g. from receiving VBus primitives)</li>
</ul>
<p>The event handler can be called from multiple sources:</p>
<ul>
<li>from the event pump implemented in <code>ResolVBus_LiveTransceiver_HandleTimer</code>: this function must be called &quot;frequently&quot; (see its documentation for details). The function takes the time that has passed since the last call as its second argument. That time is used to drive forward the internal state machine.</li>
<li>from the decoding state machine in <code>ResolVBus_LiveTransceiver_Decode</code>: this function must be called for every chunk of VBus bytes. If a VBus primitive can be decoded from those bytes, an event is emitted.</li>
</ul>
<h2 id="accessing-the-liveencoder"><a class="header" href="#accessing-the-liveencoder">Accessing the &quot;LiveEncoder&quot;</a></h2>
<p>To queue VBus primitives to be transmitted the user can access the &quot;LiveEncoder&quot; part using the <code>ResolVBus_LiveTransceiver_GetEncoder</code> function.</p>
<h2 id="accessing-the-livedecoder"><a class="header" href="#accessing-the-livedecoder">Accessing the &quot;LiveDecoder&quot;</a></h2>
<p>To decode a chunk of bytes received, those bytes have to be passed to the <code>ResolVBus_LiveTransceiver_Decode</code> function.</p>
<h2 id="performing-an-action"><a class="header" href="#performing-an-action">Performing an action</a></h2>
<p>To communicate with a VBus controller an action can be started on the &quot;LiveTransceiver&quot;. Those actions can:</p>
<ul>
<li>optionally transmit VBus primitives (requests)</li>
<li>wait for reception of VBus primitives (requests or responses)</li>
<li>have an optional timeout and retry managment</li>
</ul>
<p>The following actions are currently implemented:</p>
<ul>
<li><code>ResolVBus_LiveTransceiver_WaitForFreeBus</code>: wait for a VBus datagram with command 0x0500, indicating that the VBus controller offers control over the VBus timing to another device</li>
<li><code>ResolVBus_LiveTransceiver_ReleaseBus</code>: return VBus timing control back to the VBus controller</li>
<li><code>ResolVBus_LiveTransceiver_GetValueById</code>: get a value from the controller</li>
<li><code>ResolVBus_LiveTransceiver_SetValueById</code>: set a value in the controller</li>
<li><code>ResolVBus_LiveTransceiver_GetValueIdByIdHash</code>: lookup a value's ID by the corresponding ID hash</li>
</ul>
<p>All those actions take multiple arguments:</p>
<ul>
<li>the transceiver instance</li>
<li>zero or more action related arguments like VBus controller address, value ID, etc.</li>
<li>an optional <code>RESOLVBUS_LIVETRANSCEIVEROPTIONS</code> pointer, if custom timeout and/or retry options should be used</li>
<li>a function pointer to report completion or timeout back to the caller</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="LiveDecoder.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="Debugging.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="LiveDecoder.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="Debugging.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
